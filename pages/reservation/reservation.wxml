<import src="/dist/field/index.wxml" />
<import src="/dist/noticebar/index.wxml" />
<form report-submit='true' bindsubmit="tobuy">
  <view class="container" style="margin-bottom:110rpx;">
    <!-- 通告栏 -->
    <block wx:if="{{movable.text!=''}}">
      <view class="zan-panel" style="margin-top:0;">
        <template is="zan-noticebar" data="{{ ...movable, componentId: 'movable'  }}"></template>
      </view>
    </block>
    <!-- 主图 -->
    <view class="zan-panel" style="margin-top:0;">
      <view class="zan-row">
        <image src="{{detail.picture}}" style="width:100%;height:500rpx;"></image>
      </view>
      <view class="zan-row" style="position: absolute;bottom:20rpx;left:50rpx;color:white;">
        <view class="zan-font-16">{{detail.name}}</view>
        <view class="zan-font-12">
          {{detail.bodyStructure}}|{{detail.displacement}} {{detail.stalls}}|乘坐{{detail.numberOfPeople}}人
        </view>
      </view>
    </view>
    <view class="zan-panel">
      <view class="zan-cell">
        <view class="zan-col zan-col-8" style="color:#C0C0C0;">接亲日期</view>
        <view class="zan-col zan-col-16" style="color:red;">{{useCarDate}}</view>
      </view>
      <view class="zan-cell">
        <view class="zan-col zan-col-8" style="color:#C0C0C0;">用车需求</view>
        <view class="zan-col zan-col-16" style="color:red;">{{useCarStr}}</view>
      </view>
    </view>
    <view class="zan-panel">
      <view class="zan-cell">
        <view class="zan-font-24" style="color:#C0C0C0">填写预约人信息</view>
      </view>
      <template is="zan-field" data="{{ ...config.form.name }}"></template>
      <template is="zan-field" data="{{ ...config.form.tel }}"></template>
    </view>
    <view class="zan-panel">
      <view class="zan-cell">
        <set-address  style="width:100%;" bindsetAddress="setAddress" addresses="{{addresses}}"></set-address>
      </view>
    </view>
    <!-- 优惠券、支付方式 -->
    <view class="zan-panel">
      <view class="zan-row">
        <view class="zan-cell">
          <view class="zan-col zan-col-8" style="color:#C0C0C0;">优惠券</view>
          <view class="zan-col zan-col-16">
            <navigator class="zan-cell zan-cell--access" url="{{ item.path }}">
              <view class="zan-cell__bd">暂无任何优惠券</view>
              <view class="zan-cell__ft"></view>
            </navigator>
          </view>
        </view>
      </view>
      <view class="zan-row">
        <view class="zan-cell">
          <view class="zan-col zan-col-8" style="color:#C0C0C0;">支付方式</view>
          <view class="zan-col zan-col-16">
            <block wx:if="{{detail.earnestMoney>0}}">
              <button bindtap="changePayMode" class="zan-btn zan-btn--small button-hover {{payMode==0?'zan-btn--primary':''}}">
                定金支付
              </button>
              <button bindtap="changePayMode" class="zan-btn zan-btn--small  button-hover  {{payMode==1?'zan-btn--primary':''}}">
                全额支付
              </button>
            </block>
            <block wx:else="">
              <button class="zan-btn zan-btn--small  zan-btn--primary button-hover">全额支付</button>
            </block>
          </view>
        </view>
      </view>
    </view>
    <view class="zan-panel">
      <view class="zan-cell">
        <view class="zan-icon zan-icon-passed" style="color:#179FF0;margin-right:8rpx;"></view>
        <view>已阅读并同意</view>
        <navigator url="/pages/help/service/service" hover-class="navigator-hover" style="color:#179FF0;">
          预订条款、预订须知
        </navigator>
      </view>
    </view>
  </view>
  <!-- 底部栏 -->
  <view class="footer-box">
    <view class='zan-col zan-col-16' style="line-height: 100rpx;margin-left:30rpx;">
      <view>
        <block wx:if="{{payMode==0}}">
          <label class="zan-font-16">定金</label>
          <label style="color:#F4B900;font-size: 50rpx;">￥</label>
          <label style="color:#F4B900;font-size: 50rpx;">{{payAmount}}</label>
        </block>
        <block wx:else="">
          <label class="zan-font-16">全额</label>
          <label style="color:#F4B900;font-size: 50rpx;">￥</label>
          <label style="color:#F4B900;font-size: 50rpx;">{{payAmount}}</label>
        </block>
        <label bindtap="togglePopup" style="font-size:22rpx;float:right;margin-right:10rpx;">
          费用明细
        </label>
      </view>
    </view>
    <button class="zan-col zan-col-8 now-buy " style="border-radius:0" formType="submit">
      提交订单
    </button>
  </view>
</form>
<!-- 弹出层 费用明细 -->
<view class="zan-popup {{ showPopup ? 'zan-popup--show' : ''}}">
  <view class="zan-popup__mask" bindtap="togglePopup"></view>
  <view class="zan-popup__container popup-example--center " style="width:100%;">
    <view class="zan-panel">
      <view class="doc-title" style="text-align: center;">费用明细</view>
      <view class="zan-cell">
        <view class="zan-col zan-col-16">基础价（含8小时60公里）</view>
        <view class="zan-col zan-col-8" style="text-align: right;">￥{{detail.averageAmount}}</view>
      </view>
      <view class="zan-cell">
        <view class="zan-col zan-col-16">超出每10公里{{detail.beyond10KmFee}}元</view>
        <view class="zan-col zan-col-8" style="text-align: right;">￥{{totalBeyond10KmFee}}</view>
      </view>
      <view class="zan-cell">
        <view class="zan-col zan-col-16">超出每小时{{detail.beyondHourFee}}元</view>
        <view class="zan-col zan-col-8" style="text-align: right;">￥{{totalBeyondHourFee}}</view>
      </view>
      <view class="zan-cell">
        <view class="zan-col zan-col-16">其它费用</view>
        <view class="zan-col zan-col-8" style="text-align: right;">￥{{detail.otherFee}}</view>
      </view>
      <view class="zan-cell">
        <view class="zan-col zan-col-16 zan-pull-right">优惠</view>
        <view class="zan-col zan-col-8" style="text-align: right;">
          <view class="zan-tag zan-tag--danger zan-tag--plain">-￥{{discountFee}}</view>
        </view>
      </view>
      <view class="zan-cell">
        <view class="zan-col zan-col-18 zan-font-24" style="text-align: right;">全额:</view>
        <view class="zan-col zan-col-6 zan-font-24">
          <view style="color:#F4B900;text-align: left;">￥{{actualAmount}}</view>
        </view>
      </view>
      <block wx:if="{{payMode==0}}">
        <view class="zan-cell">
          <view class="zan-c-red zan-font-bold">您选择了定金支付，剩余费用请在取车时支付</view>
        </view>
      </block>
      <view class="zan-row">
        <view class="zan-cell" style="display: block;">
          <view>费用说明</view>
          <view>1保险费用：指租车公司向您提供的车辆均购买有交强险及商业保险，保障您用车安全的一种服务，按天收费。</view>
          <view>2基础服务费：门店收取用于车辆清洁、车辆保养、单据制作、人员服务等。</view>
        </view>
      </view>
    </view>
  </view>
</view>
<!-- 弹出框 设置地址 -->
<view class="modal-box {{modalName=='defualtmodal'?'cur':''}}">
  <view class='modal-dialog'>
    <view class="modal-title">
      <text>设置 {{modalTitle}}</text>
      <view class='bar-close badge danger round' bindtap='closeModal'>
        <text class='iconfont icon-close'></text>
      </view>
    </view>
    <view class='modal-bd'>
      <!-- 主体 -->
      <view class='form-box'>
        <view class='form-item'>
          <view class='form-title'>选择时间</view>
          <picker mode="time" value="{{time}}" start="08:00" end="21:01" bindchange="bindTimeChange">
            <view class="picker">{{time}}</view>
          </picker>
        </view>
        <view class='form-item'>
          <view class='form-title'>填写地址</view>
          <view class='form-input'  bindtap="selectAddress">
            <input class='' value="{{address}}" type="text" disabled="true" placeholder="请点击定位地址"></input>
          </view>
          <view class='form-input-btn' bindtap="selectAddress">
            <text class='iconfont icon-locationfill warning-text'></text>
          </view>
        </view>
      </view>
    </view>
    <view class='modal-option'>
      <view class='modal-option-btn' bindtap='closeModal'>取消</view>
      <view class='modal-option-btn success-text' bindtap='saveModal' data-time="{{time}}" data-address="{{address}}" data-title="{{modalTitle}}">
        确认
      </view>
    </view>
  </view>
</view>